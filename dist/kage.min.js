/*! kage.js v0.5.0
 *  Licensed under GPL-3.0
 *  https://github.com/kurgm/kage-engine#readme
 */
var Kage=function(){"use strict";var t=function(){function t(){this.hash={}}return t.prototype.set=function(t,e){this.hash[t]=e},t.prototype.search=function(t){return this.hash[t]?this.hash[t]:""},t.prototype.push=function(t,e){this.set(t,e)},t}(),e=function(){function t(){this.array=[]}return t.prototype.clear=function(){this.array=[]},t.prototype.push=function(t){var e=200,r=0,n=200,o=0;if(!(t.length<3)){t.floor();for(var i=0,a=t.array;i<a.length;i++){var s=a[i],h=s.x,u=s.y;if(h<e&&(e=h),h>r&&(r=h),u<n&&(n=u),u>o&&(o=u),isNaN(h)||isNaN(u))return}e!==r&&n!==o&&this.array.push(t)}},t.prototype.generateSVG=function(t){var e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" baseProfile="full" viewBox="0 0 200 200" width="200" height="200">\n';if(t)for(var r=0,n=this.array;r<n.length;r++){var o=n[r].array,i="L";e+='<path d="';for(var a=0;a<o.length;a++)0===a?e+="M ":o[a].off?(e+="Q ",i="Q"):"Q"!==i||o[a-1].off?"L"===i&&1===a&&(e+="L "):e+="L ",e+="".concat(o[a].x,",").concat(o[a].y," ");e+='Z" fill="black" />\n'}else e+='<g fill="black">\n',e+=this.array.map((function(t){var e=t.array;return'<polygon points="'.concat(e.map((function(t){var e=t.x,r=t.y;return"".concat(e,",").concat(r," ")})).join(""),'" />\n')})).join(""),e+="</g>\n";return e+="</svg>\n"},t.prototype.generateEPS=function(){var t="";t+="%!PS-Adobe-3.0 EPSF-3.0\n%%BoundingBox: 0 -208 1024 816\n%%Pages: 0\n%%Title: Kanji glyph\n%%Creator: GlyphWiki powered by KAGE system\n%%CreationDate: ".concat((new Date).toString(),"\n%%EndComments\n%%EndProlog\n");for(var e=0,r=this.array;e<r.length;e++){for(var n=r[e].array,o=0;o<n.length;o++)t+="".concat(5*n[o].x," ").concat(1e3-5*n[o].y-200," "),t+=0===o?"newpath\nmoveto\n":"lineto\n";t+="closepath\nfill\n"}return t+="%%EOF\n"},t}();"undefined"!=typeof Symbol&&Symbol.iterator&&(e.prototype[Symbol.iterator]=function(){return this.array[Symbol.iterator]()});var r=Math.hypot?Math.hypot.bind(Math):function(t,e){return Math.sqrt(t*t+e*e)};function n(t,e){var n=t[0],o=t[1];if(void 0===e&&(e=1),0===n&&0===o)return[1/n==1/0?e:-e,0];var i=e/r(n,o);return[n*i,o*i]}function o(t,e,r,n){var o=1-n;return o*o*t+o*n*2*e+n*n*r}function i(t,e,r,n){return 2*(n*(t-2*e+r)-t+e)}function a(t,e,r,n,o){var i=1-o;return i*i*i*t+i*i*o*3*e+i*o*o*3*r+o*o*o*n}function s(t,e,r,n,o){return 3*(o*(o*(3*e-t-3*r+n)+2*(t-2*e+r))-t+e)}function h(t,e,r,n){for(void 0===n&&(n=1e-5);e+n<r;){var o=e+(r-e)/3,i=r-(r-e)/3;t(o)<t(i)?r=i:e=o}return e+(r-e)/2}function u(t,e){return void 0===e&&(e=1e8),Math.round(t*e)/e}function f(t,e,r,n){return t*n-r*e}function k(t,e,r,n,o,i,a,s){var h=f(r-t,n-e,a-o,s-i);if(isNaN(h))return!0;if(0===h)return!1;var k=f(r-t,n-e,o-t,i-e),y=f(r-t,n-e,a-t,s-e),c=f(a-o,s-i,t-o,e-i),p=f(a-o,s-i,r-o,n-i);return u(k*y,1e5)<=0&&u(c*p,1e5)<=0}function y(t,e,r,n,o){var i,a,s,h;return r<e+100?(i=n,s=n,a=e+100,h=t+100):(i=e+100,s=t+100,a=o,h=o),Math.floor((r-i)/(a-i)*(h-s)+s)}var c,p=function(){function t(t){this.a1_100=t[0],this.a2_100=t[1],this.a3_100=t[2],this.x1=t[3],this.y1=t[4],this.x2=t[5],this.y2=t[6],this.x3=t[7],this.y3=t[8],this.x4=t[9],this.y4=t[10],this.a1_opt=Math.floor(this.a1_100/100),this.a1_100%=100,this.a2_opt=Math.floor(this.a2_100/100),this.a2_100%=100,this.a2_opt_1=this.a2_opt%10,this.a2_opt_2=Math.floor(this.a2_opt/10)%10,this.a2_opt_3=Math.floor(this.a2_opt/100),this.a3_opt=Math.floor(this.a3_100/100),this.a3_100%=100,this.a3_opt_1=this.a3_opt%10,this.a3_opt_2=Math.floor(this.a3_opt/10)}return t.prototype.getControlSegments=function(){var t=[];switch(0===this.a1_opt?this.a1_100:1){case 0:case 8:case 9:break;case 6:case 7:t.unshift([this.x3,this.y3,this.x4,this.y4]);case 2:case 12:case 3:case 4:t.unshift([this.x2,this.y2,this.x3,this.y3]);default:t.unshift([this.x1,this.y1,this.x2,this.y2])}return t},t.prototype.isCross=function(t,e,r,n){return this.getControlSegments().some((function(o){return k(o[0],o[1],o[2],o[3],t,e,r,n)}))},t.prototype.isCrossBox=function(t,e,r,n){return this.getControlSegments().some((function(o){return function(t,e,r,n,o,i,a,s){return!!(k(t,e,r,n,o,i,a,i)||k(t,e,r,n,a,i,a,s)||k(t,e,r,n,o,s,a,s)||k(t,e,r,n,o,i,o,s))}(o[0],o[1],o[2],o[3],t,e,r,n)}))},t.prototype.stretch=function(t,e,r,n,o,i,a,s){this.x1=y(t,e,this.x1,o,i),this.y1=y(r,n,this.y1,a,s),this.x2=y(t,e,this.x2,o,i),this.y2=y(r,n,this.y2,a,s),99===this.a1_100&&0===this.a1_opt||(this.x3=y(t,e,this.x3,o,i),this.y3=y(r,n,this.y3,a,s),this.x4=y(t,e,this.x4,o,i),this.y4=y(r,n,this.y4,a,s))},t.prototype.getBox=function(){var t=1/0,e=1/0,r=-1/0,n=-1/0;switch(0===this.a1_opt?this.a1_100:6){default:t=Math.min(t,this.x4),r=Math.max(r,this.x4),e=Math.min(e,this.y4),n=Math.max(n,this.y4);case 2:case 3:case 4:t=Math.min(t,this.x3),r=Math.max(r,this.x3),e=Math.min(e,this.y3),n=Math.max(n,this.y3);case 1:case 99:t=Math.min(t,this.x1,this.x2),r=Math.max(r,this.x1,this.x2),e=Math.min(e,this.y1,this.y2),n=Math.max(n,this.y1,this.y2);case 0:}return{minX:t,maxX:r,minY:e,maxY:n}},t}();function g(t,e,r,n,o,i,a){var s=Math.floor(.5*a.length),h=s/a.length,u=t+(r-t)*h,f=e+(n-e)*h,k=r+(o-r)*h,y=n+(i-n)*h,c=u+(k-u)*h,p=f+(y-f)*h;return{index:s,off:[[t,e,u,f,c,p],[c,p,k,y,o,i]]}}function x(t,e,r){var n=t[0],i=n[0],a=n[1],s=t[t.length-1],u=s[0],f=s[1],k=h((function(e){return t.reduce((function(r,n,a){var s=a/(t.length-1),h=o(i,e,u,s);return r+Math.pow(n[0]-h,2)}),0)}),e-8,e+8),y=h((function(e){return t.reduce((function(r,n,i){var s=i/(t.length-1),h=o(a,e,f,s);return r+Math.pow(n[1]-h,2)}),0)}),r-8,r+8);return[i,a,k,y,u,f]}function d(t,e,r,h,f,k,y,c,p,g){var x,d,v,M,l={left:[],right:[]};r===f&&h===k?(x=function(e){return o(t,r,y,e)},d=function(t){return o(e,h,c,t)},v=function(e){return i(t,r,y,e)},M=function(t){return i(e,h,c,t)}):(x=function(e){return a(t,r,f,y,e)},d=function(t){return a(e,h,k,c,t)},v=function(e){return s(t,r,f,y,e)},M=function(t){return s(e,h,k,c,t)});for(var _=0;_<=1e3;_+=p){var j=_/1e3,m=x(j),P=d(j),w=v(j),W=M(j),A=g(j),b=0===u(w)&&0===u(W)?[-A,0]:n([-W,w],A),Y=b[0],S=b[1];l.left.push([m-Y,P-S]),l.right.push([m+Y,P+S])}return l}!function(t){t[t.kMincho=0]="kMincho",t[t.kGothic=1]="kGothic"}(c||(c={}));var v=function(){function t(t){if(this._precision=10,this._array=[],t)if("number"==typeof t)for(var e=0;e<t;e++)this.push(0,0,!1);else for(var r=0,n=t;r<n.length;r++){var o=n[r],i=o.x,a=o.y,s=o.off;this.push(i,a,s)}}return Object.defineProperty(t.prototype,"array",{get:function(){var t=this;return this._array.map((function(e,r){return t.get(r)}))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._array.length},enumerable:!1,configurable:!0}),t.prototype.push=function(t,e,r){void 0===r&&(r=!1),this._array.push(this.createInternalPoint(t,e,r))},t.prototype.pushPoint=function(t){this.push(t.x,t.y,t.off)},t.prototype.set=function(t,e,r,n){void 0===n&&(n=!1),this._array[t]=this.createInternalPoint(e,r,n)},t.prototype.setPoint=function(t,e){this.set(t,e.x,e.y,e.off)},t.prototype.get=function(t){var e=this._array[t],r=e.x,n=e.y,o=e.off;return 0===this._precision?{x:r,y:n,off:o}:{x:r/this._precision,y:n/this._precision,off:o}},t.prototype.reverse=function(){this._array.reverse()},t.prototype.concat=function(t){if(this._precision!==t._precision)throw new TypeError("Cannot concat polygon's with different precisions");this._array=this._array.concat(t._array)},t.prototype.shift=function(){this._array.shift()},t.prototype.unshift=function(t,e,r){void 0===r&&(r=!1),this._array.unshift(this.createInternalPoint(t,e,r))},t.prototype.clone=function(){return new t(this.array)},t.prototype.createInternalPoint=function(t,e,r){return void 0===r&&(r=!1),0===this._precision?{x:t,y:e,off:r}:{x:t*this._precision,y:e*this._precision,off:r}},t.prototype.translate=function(t,e){0!==this._precision&&(t*=this._precision,e*=this._precision);for(var r=0,n=this._array;r<n.length;r++){var o=n[r];o.x+=t,o.y+=e}return this},t.prototype.reflectX=function(){for(var t=0,e=this._array;t<e.length;t++){e[t].x*=-1}return this},t.prototype.reflectY=function(){for(var t=0,e=this._array;t<e.length;t++){e[t].y*=-1}return this},t.prototype.rotate90=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=-o,r.y=n}return this},t.prototype.rotate180=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t];r.x*=-1,r.y*=-1}return this},t.prototype.rotate270=function(){for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=o,r.y=-n}return this},t.prototype.floor=function(){if(0===this._precision)return this;for(var t=0,e=this._array;t<e.length;t++){var r=e[t],n=r.x,o=r.y;r.x=Math.floor(n),r.y=Math.floor(o)}return this},t}();"undefined"!=typeof Symbol&&Symbol.iterator&&(v.prototype[Symbol.iterator]=function(){var t=this,e=0;return{next:function(){return e<t._array.length?{done:!1,value:t.get(e++)}:{done:!0,value:void 0}}}});var M=function(){function t(t,e){this.cos_theta=1,this.sin_theta=0,this.x=t,this.y=e}return t.prototype.setMatrix2=function(t,e){return this.cos_theta=t,this.sin_theta=e,this},t.prototype.setLeft=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],i=r[1];return this.setMatrix2(-o,-i),this},t.prototype.setRight=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],i=r[1];return this.setMatrix2(o,i),this},t.prototype.setUp=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],i=r[1];return this.setMatrix2(-i,o),this},t.prototype.setDown=function(t,e){var r=n([t-this.x,e-this.y]),o=r[0],i=r[1];return this.setMatrix2(i,-o),this},t.prototype.move=function(t,e){var r;return r=this.getPoint(t,e),this.x=r.x,this.y=r.y,this},t.prototype.getPoint=function(t,e,r){return void 0===r&&(r=!1),{x:this.x+this.cos_theta*t+-this.sin_theta*e,y:this.y+this.sin_theta*t+this.cos_theta*e,off:r}},t.prototype.getPolygon=function(t){var e=this;return new v(t.map((function(t){var r=t.x,n=t.y,o=t.off;return e.getPoint(r,n,o)})))},t}();function l(t,e,o,i,a,s,h,u,f,k,y,c,p,l,_,j){var m=y,P=c,w=t.kMinWidthT-p/2,W=o,A=i,b=void 0;switch(m%100){case 0:case 7:case 27:b=-1*t.kMinWidthY*.5;break;case 1:case 2:case 6:case 22:case 32:b=0;break;case 12:b=t.kMinWidthY}if(void 0===b)W=A=void 0;else if(0!==b){var Y=W===a&&A===s?[0,b]:n([W-a,A-s],b);W+=Y[0],A+=Y[1]}var S=0;if(void 0!==W&&void 0!==A&&(22===m||27===m)&&7===P&&w>6){var U=r(a-W,s-A)+r(h-a,u-s)+r(f-h,k-u);U<100&&(W+=S=(100-U)/100*(w-6))}var L,K=f,T=k;switch(P%100){case 0:case 1:case 7:case 9:case 15:case 14:case 17:case 5:L=0;break;case 8:L=-1*w*.5;break;default:L=b}if(void 0===L)K=T=void 0;else if(0!==L){var R=h===K&&u===T?[0,-L]:n([K-h,T-u],L);K+=R[0],T+=R[1]}(void 0!==W&&void 0!==A&&void 0!==K&&void 0!==T&&function(t,e,n,o,i,a,s,h,u,f,k,y,c,p,M){var l=i===s&&a===h;if(l&&t.kUseCurve){var _=.5,j=7===k&&0===y?function(t){return 1.1*Math.pow(t,_)}:7===k?function(t){return Math.pow(t,_)}:7===y?function(t){return Math.pow(1-t,_)}:p>0?function(t){return 1-p/2/(c-M/2)+p/2/(c-M)*t}:function(){return 1},m=d(n,o,i,a,i,a,u,f,10,(function(t){var e=j(t);return e<.15&&(e=.15),c*e})),P=m.left,w=m.right,W=g(n,o,i,a,u,f,P),A=W.off,b=A[0],Y=A[1],S=W.index,U=P.slice(0,S+1),L=P.slice(S),K=g(n,o,i,a,u,f,w),T=K.off,R=T[0],C=T[1],D=K.index,X=x(U,b[2],b[3]),E=x(L,Y[2],Y[3]),B=new v([{x:X[0],y:X[1]},{x:X[2],y:X[3],off:!0},{x:X[4],y:X[5]},{x:E[2],y:E[3],off:!0},{x:E[4],y:E[5]}]);(z=new v([{x:w[0][0],y:w[0][1]},{x:R[2]-(X[2]-b[2]),y:R[3]-(X[3]-b[3]),off:!0},{x:w[D][0],y:w[D][1]},{x:C[2]-(E[2]-Y[2]),y:C[3]-(E[3]-Y[3]),off:!0},{x:w[w.length-1][0],y:w[w.length-1][1]}])).reverse(),B.concat(z),e.push(B)}else{var G=.5;r(u-n,f-o)<50&&(G+=.4*(1-r(u-n,f-o)/50));for(var O=7!==k&&27!==k||0!==y?7===k||27===k?l?function(t){return Math.pow(t,G)}:function(t){return Math.pow(Math.pow(t,G),.7)}:7===y?function(t){return Math.pow(1-t,G)}:l&&(p>0||M>0)?function(e){return(t.kMinWidthT-p/2-(M-p)/2*e)/t.kMinWidthT}:function(){return 1}:function(e){return Math.pow(e,G)*t.kL2RDfatten},F=d(n,o,i,a,s,h,u,f,t.kRate,(function(t){var e=O(t);return e<.15&&(e=.15),c*e})),I=F.left,N=F.right,z=(B=new v,new v),Q=0,H=I;Q<H.length;Q++){var q=H[Q],V=q[0],Z=q[1];B.push(V,Z)}for(var $=0,J=N;$<J.length;$++){var tt=J[$];V=tt[0],Z=tt[1];z.push(V,Z)}if(132===k||22===k&&(l?o>f:n>i)){B.floor(),z.floor();for(var et=0,rt=z.length;et+1<rt;et++){var nt=z.get(et),ot=z.get(et+1);if(nt.y<=o&&o<=ot.y){for(var it=ot.x+(nt.x-ot.x)*(o-ot.y)/(nt.y-ot.y),at=o,st=B.get(0),ht=B.get(1),ut=132===k?st.x+(ht.x-st.x)*(o-st.y)/(ht.y-st.y):st.x+(ht.x-st.x+1)*(o-st.y)/(ht.y-st.y),ft=132===k?o:o+1,kt=0;kt<et;kt++)z.shift();z.set(0,it,at),B.unshift(ut,ft);break}}}z.reverse(),B.concat(z),e.push(B)}}(t,e,W,A,a,s,h,u,K,T,m,P,w,_,j),void 0!==W&&void 0!==A)&&function(t,e,r,n,o,i,a,s,h,u){switch(a){case 12:var f=new M(r,n);r!==o&&f.setDown(o,i);var k=f.getPolygon([{x:-s,y:0},{x:+s,y:0},{x:-s,y:-s}]);t.push(k);break;case 0:if(h){f=new M(r,n);r!==o&&f.setDown(o,i);var y=Math.atan2(Math.abs(n-i),Math.abs(r-o))/Math.PI*2-.4,c=(y*=y>0?2:16)<0?-1:1;k=f.getPolygon([{x:-s,y:1},{x:+s,y:0},{x:-c*s,y:-e.kMinWidthY*Math.abs(y)}]);t.push(k);var p=y<0?-y*e.kMinWidthY:0,g=f.getPolygon(r===o&&n===i?[{x:s,y:-p},{x:1.5*s,y:e.kMinWidthY-p},{x:s-2,y:2*e.kMinWidthY+1}]:[{x:s,y:-p},{x:1.5*s,y:e.kMinWidthY-1.2*p},{x:s-2,y:2*e.kMinWidthY-.8*p+1}]);t.push(g)}else{f=new M(r,n);r===o?f.setMatrix2(0,1):f.setRight(o,i);k=f.getPolygon([{x:0,y:+s},{x:0,y:-s},{x:-e.kMinWidthY,y:-s}]);t.push(k);g=f.getPolygon([{x:0,y:+s},{x:+e.kMinWidthY,y:1.5*+s},{x:3*+e.kMinWidthY,y:.5*+s}]);t.push(g)}break;case 22:case 27:k=new M(r-u,n).getPolygon([{x:-s,y:-e.kMinWidthY},{x:0,y:-e.kMinWidthY-e.kWidth},{x:+s+e.kWidth,y:+e.kMinWidthY},{x:+s,y:+s-1}].concat(27===a?[{x:0,y:+s+2},{x:0,y:0}]:[{x:-s,y:+s+4}]));t.push(k)}}(e,t,W,A,a,s,m,w,void 0!==T&&A<=T,S);void 0!==K&&void 0!==T&&function(t,e,r,n,o,i,a,s,h,u,f,k){switch(s){case 1:case 8:case 15:var y=e.kMinWidthT-f/2,c=new M(o,i);r===o?c.setMatrix2(0,1):n!==i&&c.setLeft(r,n);var p=c.getPolygon(e.kUseCurve?[{x:0,y:-y},{x:.9*+y,y:.9*-y,off:!0},{x:+y,y:0},{x:.9*+y,y:.9*+y,off:!0},{x:0,y:+y}]:[{x:0,y:-y},{x:.7*+y,y:.7*-y},{x:+y,y:0},{x:.7*+y,y:.7*+y},{x:0,y:+y}]);if(r===o&&p.reverse(),t.push(p),15===s){var g=new M(o,i);k&&g.setMatrix2(-1,0);var x=g.getPolygon([{x:0,y:1-h},{x:2,y:-h-5*e.kWidth},{x:0,y:-h-5*e.kWidth},{x:-h,y:1-h}]);t.push(x)}break;case 0:if(7!==a&&27!==a)break;case 9:var d=Math.atan2(Math.abs(i-n),Math.abs(o-r))/Math.PI*2-.6,v=(d*=d>0?8:3)<0?-1:1;c=new M(o,i);n===i?c.setMatrix2(1,0):r===o?c.setMatrix2(0,i>n?-1:1):c.setLeft(r,n);p=c.getPolygon([{x:0,y:+h*e.kL2RDfatten},{x:0,y:-h*e.kL2RDfatten},{x:Math.abs(d)*h*e.kL2RDfatten,y:v*h*e.kL2RDfatten}]);t.push(p);break;case 14:var l=h>6?6/h:1,_=4*e.kWidth*Math.min(1-u/10,Math.pow(h/e.kMinWidthT,3))*l;p=new M(o,i).getPolygon([{x:0,y:0},{x:0,y:-h},{x:-_,y:-h},{x:-_,y:.5*-h}]);t.push(p)}}(e,t,h,u,K,T,m,P,w,l,j,void 0!==A&&T<=A)}function _(t,e,r,n,o,i,a,s,h,u,f,k,y,c,p,g){l(t,e,r,n,o,i,a,s,h,u,f,k,y,c,p,g)}function j(t,e,r,n,o,i,a,s,h,u,f,k,y,c){l(t,e,r,n,o,i,o,i,a,s,h,u,f,k,y,c)}function m(t,e,r,o,i,a,s,h,u,f,k){var y=r,c=o,p=i,g=a,x=s,d=h,l=t.kMinWidthT-u/2;if(y===p||c!==g&&(y>p||Math.abs(g-c)>=Math.abs(p-y)||6===x||6===d)){var _=y===p?[0,1]:n([p-y,g-c]),j=_[0],m=_[1],P=new M(y,c),w=new M(p,g);P.setMatrix2(m,-j),w.setMatrix2(m,-j);var W=new v(4);switch(x){case 0:W.setPoint(0,P.getPoint(l,t.kMinWidthY/2)),W.setPoint(3,P.getPoint(-l,-t.kMinWidthY/2));break;case 1:case 6:W.setPoint(0,P.getPoint(l,0)),W.setPoint(3,P.getPoint(-l,0));break;case 12:W.setPoint(0,P.getPoint(l,-t.kMinWidthY)),W.setPoint(3,P.getPoint(-l,-t.kMinWidthY-l));break;case 22:if(y===p)W.set(0,y+l,c),W.set(3,y-l,c);else{var A=y>p?-1:1;W.set(0,y+(l+A)/m,c+1),W.set(3,y-l/m,c)}break;case 32:y===p?(W.set(0,y+l,c-t.kMinWidthY),W.set(3,y-l,c-t.kMinWidthY)):(W.set(0,y+l/m,c),W.set(3,y-l/m,c))}switch(d){case 0:6===x?(W.setPoint(1,w.getPoint(l,0)),W.setPoint(2,w.getPoint(-l,0))):(W.setPoint(1,w.getPoint(l,-l/2)),W.setPoint(2,w.getPoint(-l,l/2)));break;case 5:if(y===p)break;case 1:W.setPoint(1,w.getPoint(l,0)),W.setPoint(2,w.getPoint(-l,0));break;case 13:W.setPoint(1,w.getPoint(l,t.kAdjustKakatoL[k])),W.setPoint(2,w.getPoint(-l,t.kAdjustKakatoL[k]+l));break;case 23:W.setPoint(1,w.getPoint(l,t.kAdjustKakatoR[k])),W.setPoint(2,w.getPoint(-l,t.kAdjustKakatoR[k]+l));break;case 24:case 32:y===p?(W.set(1,p+l,g+t.kMinWidthY),W.set(2,p-l,g+t.kMinWidthY)):(W.set(1,p+l/m,g),W.set(2,p-l/m,g))}switch(e.push(W),d){case 24:var b=new M(p,g).getPolygon([{x:0,y:+t.kMinWidthY},y===p?{x:+l,y:3*-t.kMinWidthY}:{x:.5*+l,y:4*-t.kMinWidthY},{x:2*+l,y:-t.kMinWidthY},{x:2*+l,y:+t.kMinWidthY}]);e.push(b);break;case 13:if(4===k)if(y===p){b=new M(p,g).getPolygon([{x:-l,y:3*-t.kMinWidthY},{x:2*-l,y:0},{x:-t.kMinWidthY,y:5*+t.kMinWidthY},{x:+l,y:+t.kMinWidthY}]);e.push(b)}else{var Y=y>p&&c!==g?Math.floor((y-p)/(g-c)*3):0;b=new M(p+Y,g).getPolygon([{x:0,y:5*-t.kMinWidthY},{x:2*-l,y:0},{x:-t.kMinWidthY,y:5*+t.kMinWidthY},{x:+l,y:+t.kMinWidthY},{x:0,y:0}]);e.push(b)}}switch(x){case 22:case 27:b=new M(y,c).getPolygon([{x:-l,y:-t.kMinWidthY},{x:0,y:-t.kMinWidthY-t.kWidth},{x:+l+t.kWidth,y:+t.kMinWidthY}].concat(y===p?[{x:+l,y:+l},{x:-l,y:0}]:27===x?[{x:+l,y:+l-1},{x:0,y:+l+2},{x:0,y:0}]:[{x:+l,y:+l-1},{x:-l,y:+l+4}]));e.push(b);break;case 0:b=P.getPolygon([{x:l,y:.5*t.kMinWidthY},{x:l+.5*l,y:.5*t.kMinWidthY+t.kMinWidthY},{x:l-2,y:.5*t.kMinWidthY+2*t.kMinWidthY+1}]);y!==p&&b.set(2,y+(l-2)*m+(.5*t.kMinWidthY+2*t.kMinWidthY)*j,c+(l+1)*-j+(.5*t.kMinWidthY+2*t.kMinWidthY)*m),e.push(b)}if(y===p&&1===d||6===x&&(0===d||y!==p&&5===d)){b=new v;if(t.kUseCurve)b.pushPoint(w.getPoint(l,0)),b.push(p-j*l*.9+-m*-l*.9,g+m*l*.9+j*-l*.9,!0),b.pushPoint(w.getPoint(0,l)),b.pushPoint(w.getPoint(.9*-l,.9*l,!0)),b.pushPoint(w.getPoint(-l,0));else{var S=y===p&&(6===x&&0===d||1===d)?.6:.8;b.pushPoint(w.getPoint(l,0)),b.pushPoint(w.getPoint(.6*l,l*S)),b.pushPoint(w.getPoint(0,l)),b.pushPoint(w.getPoint(.6*-l,l*S)),b.pushPoint(w.getPoint(-l,0))}if(y===p&&(6===x&&0===d||1===d)&&b.reverse(),e.push(b),y!==p&&6===x&&5===d){var U=5*t.kWidth,L=y<p?1:-1,K=w.getPolygon([{x:L*(l-1),y:0},{x:L*(l+U),y:2},{x:L*(l+U),y:0},{x:l-1,y:-l}]);e.push(K)}}}else if(c===g&&6===x){var T=new M(y,c),R=new M(p,g);W=new v([T.getPoint(0,-l),R.getPoint(0,-l),R.getPoint(0,+l),T.getPoint(0,+l)]);switch(e.push(W),d){case 1:case 0:case 5:w=new M(p,g);y>p&&w.setMatrix2(-1,0);S=.6,b=w.getPolygon(t.kUseCurve?[{x:0,y:-l},{x:.9*+l,y:.9*-l,off:!0},{x:+l,y:0},{x:.9*+l,y:.9*+l,off:!0},{x:0,y:+l}]:[{x:0,y:-l},{x:+l*S,y:.6*-l},{x:+l,y:0},{x:+l*S,y:.6*+l},{x:0,y:+l}]);if(y>=p&&b.reverse(),e.push(b),5===d){U=t.kWidth*(4*(1-u/t.kAdjustMageStep)+1),L=y<p?1:-1;var C=w.getPolygon([{x:0,y:L*-l},{x:2,y:L*(-l-U)},{x:0,y:L*(-l-U)},{x:-l,y:L*-l}]);e.push(C)}}}else{var D=c===g?[1,0]:n([p-y,g-c]);j=D[0],m=D[1],P=new M(y,c),w=new M(p,g);P.setMatrix2(j,m),w.setMatrix2(j,m);b=new v([P.getPoint(0,-t.kMinWidthY),w.getPoint(0,-t.kMinWidthY),w.getPoint(0,t.kMinWidthY),P.getPoint(0,t.kMinWidthY)]);if(e.push(b),0===d){var X=(t.kMinWidthU/t.kMinWidthY-1)/4+1,E=w.getPolygon([{x:0,y:-t.kMinWidthY},{x:-t.kAdjustUrokoX[f]*X,y:0}]);E.push(p-(j-m)*t.kAdjustUrokoX[f]*X/2,g-(m+j)*t.kAdjustUrokoY[f]*X),e.push(E)}}}function P(t,e,r,n,o){return t.array.filter((function(t){return t.array.every((function(t){var i=t.x,a=t.y;return e<=i&&i<=n&&r<=a&&a<=o}))}))}function w(t,e,r,n,o,i,a,s,h){if(98===i&&0===s)for(var u=e+n,f=0,k=0,y=P(t,e,r,n,o);k<y.length;k++){y[k].reflectX().translate(u,f).floor()}else if(97===i&&0===s){u=0,f=r+o;for(var c=0,p=P(t,e,r,n,o);c<p.length;c++){p[c].reflectY().translate(u,f).floor()}}else if(99===i&&0===s)if(1===a&&0===h){u=e+o,f=r-e;for(var g=0,x=P(t,e,r,n,o);g<x.length;g++){x[g].rotate90().translate(u,f).floor()}}else if(2===a&&0===h){u=e+n,f=r+o;for(var d=0,v=P(t,e,r,n,o);d<v.length;d++){v[d].rotate180().translate(u,f).floor()}}else if(3===a&&0===h){u=e-r,f=o+e;for(var M=0,l=P(t,e,r,n,o);M<l.length;M++){l[M].rotate270().translate(u,f).floor()}}}var W=function(){function t(){this.shotai=c.kMincho,this.kRate=100,this.setSize()}return t.prototype.setSize=function(t){1===t?(this.kMinWidthY=1.2,this.kMinWidthT=3.6,this.kWidth=3,this.kKakato=1.8,this.kL2RDfatten=1.1,this.kMage=6,this.kUseCurve=!1,this.kAdjustKakatoL=[8,5,3,1,0],this.kAdjustKakatoR=[4,3,2,1],this.kAdjustKakatoRangeX=12,this.kAdjustKakatoRangeY=[1,11,14,18],this.kAdjustKakatoStep=3,this.kAdjustUrokoX=[14,12,9,7],this.kAdjustUrokoY=[7,6,5,4],this.kAdjustUrokoLength=[13,21,30],this.kAdjustUrokoLengthStep=3,this.kAdjustUrokoLine=[13,15,18]):(this.kMinWidthY=2,this.kMinWidthU=2,this.kMinWidthT=6,this.kWidth=5,this.kKakato=3,this.kL2RDfatten=1.1,this.kMage=10,this.kUseCurve=!1,this.kAdjustKakatoL=[14,9,5,2,0],this.kAdjustKakatoR=[8,6,4,2],this.kAdjustKakatoRangeX=20,this.kAdjustKakatoRangeY=[1,19,24,30],this.kAdjustKakatoStep=3,this.kAdjustUrokoX=[24,20,16,12],this.kAdjustUrokoY=[12,11,9,8],this.kAdjustUrokoLength=[22,36,50],this.kAdjustUrokoLengthStep=3,this.kAdjustUrokoLine=[22,26,30],this.kAdjustUroko2Step=3,this.kAdjustUroko2Length=40,this.kAdjustTateStep=4,this.kAdjustMageStep=5)},t.prototype.getDrawers=function(t){var e=this;return this.adjustStrokes(t).map((function(t){return function(o){!function(t,e,o){var i=o.stroke,a=i.a1_100,s=i.a2_100,h=i.a2_opt,u=i.a2_opt_1,f=i.a2_opt_2,k=i.a2_opt_3,y=i.a3_100,c=i.a3_opt,p=i.a3_opt_1,g=i.a3_opt_2,x=i.x1,d=i.y1,v=i.x2,M=i.y2,l=i.x3,P=i.y3,W=i.x4,A=i.y4,b=o.kirikuchiAdjustment,Y=o.tateAdjustment,S=o.haneAdjustment,U=o.urokoAdjustment,L=o.kakatoAdjustment,K=o.mageAdjustment;switch(a){case 0:w(e,x,d,v,M,s,y,h,c);break;case 1:if(4===y){var T=x===v&&d===M?[0,t.kMage]:n([x-v,d-M],t.kMage);m(t,e,x,d,D=v+T[0],X=M+T[1],s+100*u,1,Y,0,0),j(t,e,D,X,v,M,v-t.kMage*((t.kAdjustTateStep+4-Y)/(t.kAdjustTateStep+4)),M,1,14,Y%10,S,Math.floor(Y/10),g)}else m(t,e,x,d,v,M,s+100*u,y,Y,U,L);break;case 2:if(4===y){var R=v===l?[0,-t.kMage]:M===P?[-t.kMage,0]:n([v-l,M-P],t.kMage);j(t,e,x,d,v,M,D=l+R[0],X=P+R[1],s+100*b,0,f,0,k,0),j(t,e,D,X,l,P,l-t.kMage,P,2,14,f,S,0,g)}else j(t,e,x,d,v,M,l,P,s+100*b,5===y&&0===c?15:y,f,p,k,g);break;case 3:var C=x===v&&d===M?[0,t.kMage]:n([x-v,d-M],t.kMage),D=v+C[0],X=M+C[1],E=v===l&&M===P?[0,-t.kMage]:n([l-v,P-M],t.kMage),B=v+E[0],G=M+E[1];if(m(t,e,x,d,D,X,s+100*u,1,Y,0,0),j(t,e,D,X,v,M,B,G,1,1,0,0,Y,K),5!==y||0!==p||v<l&&l-B>0||v>l&&B-l>0){var O=5===y&&0===p?0:p+10*K;m(t,e,B,G,l,P,6,y,K,O,O)}break;case 12:j(t,e,x,d,v,M,l,P,s+100*u,1,f,0,k,0),m(t,e,l,P,W,A,6,y,0,c,c);break;case 4:var F=r(l-v,P-M)/120*6;F>6&&(F=6);var I=x===v&&d===M?[0,t.kMage*F]:n([x-v,d-M],t.kMage*F),N=(D=v+I[0],X=M+I[1],v===l&&M===P?[0,-t.kMage*F]:n([l-v,P-M],t.kMage*F));B=v+N[0],G=M+N[1],m(t,e,x,d,D,X,s+100*u,1,f+10*k,0,0),j(t,e,D,X,v,M,B,G,1,1,0,0,0,0),5===y&&0===c&&l-B<=0||m(t,e,B,G,l,P,6,y,0,c,c);break;case 6:if(4===y){var z=l===W?[0,-t.kMage]:P===A?[-t.kMage,0]:n([l-W,P-A],t.kMage);_(t,e,x,d,v,M,l,P,D=W+z[0],X=A+z[1],s+100*u,1,f,0,k,0),j(t,e,D,X,W,A,W-t.kMage,A,1,14,0,S,0,g)}else _(t,e,x,d,v,M,l,P,W,A,s+100*u,5===y&&0===c?15:y,f,p,k,g);break;case 7:m(t,e,x,d,v,M,s+100*u,1,Y,0,0),j(t,e,v,M,l,P,W,A,1,y,Y%10,p,Math.floor(Y/10),g)}}(e,o,t)}}))},t.prototype.adjustStrokes=function(t){var e=t.map((function(t){var e=t.a2_opt_1,r=t.a2_opt_2,n=t.a2_opt_3,o=t.a3_opt;return{stroke:t,kirikuchiAdjustment:e,tateAdjustment:r+10*n,haneAdjustment:t.a3_opt_1,urokoAdjustment:o,kakatoAdjustment:o,mageAdjustment:t.a3_opt_2}}));return this.adjustHane(e),this.adjustMage(e),this.adjustTate(e),this.adjustKakato(e),this.adjustUroko(e),this.adjustUroko2(e),this.adjustKirikuchi(e),e},t.prototype.adjustHane=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(a=n[r].stroke).a1_100&&0===a.a1_opt&&a.x1===a.x2&&e.push({stroke:a,x:a.x1,y1:a.y1,y2:a.y2})}for(var o=0,i=t;o<i.length;o++){var a,s=i[o];if((1===(a=s.stroke).a1_100||2===a.a1_100||6===a.a1_100)&&0===a.a1_opt&&4===a.a3_100&&0===a.a3_opt){var h=void 0,u=void 0;1===a.a1_100?(h=a.x2,u=a.y2):2===a.a1_100?(h=a.x3,u=a.y3):(h=a.x4,u=a.y4);var f=1/0;h+18<100&&(f=h+18);for(var k=0,y=e;k<y.length;k++){var c=y[k],p=c.stroke,g=c.x,x=c.y1,d=c.y2;a!==p&&h-g<100&&g<h&&x<=u&&d>=u&&(f=Math.min(f,h-g))}f!==1/0&&(s.haneAdjustment+=7-Math.floor(f/15))}}return t},t.prototype.adjustMage=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(h=(s=n[r]).stroke).a1_100&&0===h.a1_opt&&h.y1===h.y2?e.push({stroke:h,adjStroke:s,isTarget:!1,y:h.y2,x1:h.x1,x2:h.x2}):3===h.a1_100&&0===h.a1_opt&&h.y2===h.y3&&e.push({stroke:h,adjStroke:s,isTarget:!0,y:h.y2,x1:h.x2,x2:h.x3})}for(var o=0,i=e;o<i.length;o++){var a=i[o],s=a.adjStroke,h=a.stroke,f=a.isTarget,k=a.y,y=a.x1,c=a.x2;if(f)for(var p=0,g=e;p<g.length;p++){var x=g[p],d=x.stroke,v=x.y,M=x.x1,l=x.x2;h!==d&&!(y+1>l||c-1<M)&&u(Math.abs(k-v))<this.kMinWidthT*this.kAdjustMageStep&&(s.mageAdjustment+=this.kAdjustMageStep-Math.floor(Math.abs(k-v)/this.kMinWidthT),s.mageAdjustment>this.kAdjustMageStep&&(s.mageAdjustment=this.kAdjustMageStep))}}return t},t.prototype.adjustTate=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1!==(h=(s=n[r]).stroke).a1_100&&3!==h.a1_100&&7!==h.a1_100||0!==h.a1_opt||h.x1!==h.x2||e.push({stroke:h,adjStroke:s,x:h.x1,y1:h.y1,y2:h.y2})}for(var o=0,i=e;o<i.length;o++)for(var a=i[o],s=a.adjStroke,h=a.stroke,f=a.x,k=a.y1,y=a.y2,c=0,p=e;c<p.length;c++){var g=p[c],x=g.stroke,d=g.x,v=g.y1,M=g.y2;h!==x&&!(k+1>M||y-1<v)&&u(Math.abs(f-d))<this.kMinWidthT*this.kAdjustTateStep&&(s.tateAdjustment+=this.kAdjustTateStep-Math.floor(Math.abs(f-d)/this.kMinWidthT),(s.tateAdjustment>this.kAdjustTateStep||s.tateAdjustment===this.kAdjustTateStep&&(0!==h.a2_opt_1||0!==h.a2_100))&&(s.tateAdjustment=this.kAdjustTateStep))}return t},t.prototype.adjustKakato=function(t){for(var e=this,r=function(r){var o=r.stroke;if(1===o.a1_100&&0===o.a1_opt&&(13===o.a3_100||23===o.a3_100)&&0===o.a3_opt)for(var i=function(i){if(t.some((function(t){var r=t.stroke;return o!==r&&r.isCrossBox(o.x2-e.kAdjustKakatoRangeX/2,o.y2+e.kAdjustKakatoRangeY[i],o.x2+e.kAdjustKakatoRangeX/2,o.y2+e.kAdjustKakatoRangeY[i+1])}))||u(o.y2+n.kAdjustKakatoRangeY[i+1])>200||u(o.y2-o.y1)<n.kAdjustKakatoRangeY[i+1])return r.kakatoAdjustment=3-i,"break"},a=0;a<n.kAdjustKakatoStep;a++){if("break"===i(a))break}},n=this,o=0,i=t;o<i.length;o++){r(i[o])}return t},t.prototype.adjustUroko=function(t){for(var e=function(e){var i=e.stroke;if(1===i.a1_100&&0===i.a1_opt&&0===i.a3_100&&0===i.a3_opt)for(var a=function(a){var s=i.y1===i.y2?[1,0]:i.x2-i.x1<0?n([i.x1-i.x2,i.y1-i.y2]):n([i.x2-i.x1,i.y2-i.y1]),h=s[0],f=s[1],k=i.x2-o.kAdjustUrokoLine[a]*h-.5*f,y=i.y2-o.kAdjustUrokoLine[a]*f-.5*h;if(u(i.y1===i.y2?i.x2-i.x1:r(i.y2-i.y1,i.x2-i.x1))<o.kAdjustUrokoLength[a]||t.some((function(t){var e=t.stroke;return i!==e&&e.isCross(k,y,i.x2,i.y2)})))return e.urokoAdjustment=o.kAdjustUrokoLengthStep-a,"break"},s=0;s<o.kAdjustUrokoLengthStep;s++){if("break"===a(s))break}},o=this,i=0,a=t;i<a.length;i++){e(a[i])}return t},t.prototype.adjustUroko2=function(t){for(var e=[],r=0,n=t;r<n.length;r++){1===(h=(s=n[r]).stroke).a1_100&&0===h.a1_opt&&h.y1===h.y2?e.push({stroke:h,adjStroke:s,isTarget:0===h.a3_100&&0===h.a3_opt&&0===s.urokoAdjustment,y:h.y1,x1:h.x1,x2:h.x2}):3===h.a1_100&&0===h.a1_opt&&h.y2===h.y3&&e.push({stroke:h,adjStroke:s,isTarget:!1,y:h.y2,x1:h.x2,x2:h.x3})}for(var o=0,i=e;o<i.length;o++){var a=i[o],s=a.adjStroke,h=a.stroke,f=a.isTarget,k=a.y,y=a.x1,c=a.x2;if(f){for(var p=0,g=0,x=e;g<x.length;g++){var d=x[g],v=d.stroke,M=d.y,l=d.x1,_=d.x2;h!==v&&!(y+1>_||c-1<l)&&u(Math.abs(k-M))<this.kAdjustUroko2Length&&(p+=Math.pow(this.kAdjustUroko2Length-Math.abs(k-M),1.1))}s.urokoAdjustment=Math.min(Math.floor(p/this.kAdjustUroko2Length),this.kAdjustUroko2Step)}}return t},t.prototype.adjustKirikuchi=function(t){for(var e=[],r=0,n=t;r<n.length;r++){var o=n[r].stroke;1===o.a1_100&&0===o.a1_opt&&o.y1===o.y2&&e.push({y:o.y1,x1:o.x1,x2:o.x2})}for(var i=function(t){var r=t.stroke;2===r.a1_100&&0===r.a1_opt&&32===r.a2_100&&0===r.a2_opt&&r.x1>r.x2&&r.y1<r.y2&&e.some((function(t){var e=t.y,n=t.x1,o=t.x2;return n<r.x1&&o>r.x1&&e===r.y1}))&&(t.kirikuchiAdjustment=1)},a=0,s=t;a<s.length;a++){i(s[a])}return t},t}(),A=function(t,e){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},A(t,e)};function b(t,e,r,o,i,a,s,h,u,f,k,y){var c=0;if(0!==c){var p=r===i&&o===a?[0,c]:n([r-i,o-a],c);r+=p[0],o+=p[1]}var g=0;if(0!==g){var x=s===u&&h===f?[0,-g]:n([u-s,f-h],g);u+=x[0],f+=x[1]}!function(t,e,r,n,o,i,a,s,h,u){for(var f=d(r,n,o,i,a,s,h,u,e.kRate,(function(){return e.kWidth})),k=f.left,y=f.right,c=new v,p=new v,g=0,x=k;g<x.length;g++){var M=x[g],l=M[0],_=M[1];c.push(l,_)}for(var j=0,m=y;j<m.length;j++){var P=m[j];l=P[0],_=P[1];p.push(l,_)}p.reverse(),c.concat(p),t.push(c)}(e,t,r,o,i,a,s,h,u,f)}function Y(t,e,r,n,o,i,a,s,h,u,f,k){b(t,e,r,n,o,i,a,s,h,u)}function S(t,e,r,n,o,i,a,s,h,u){b(t,e,r,n,o,i,o,i,a,s)}function U(t,e,r,n,o,i,a,s){var h,u,f,k,y,c;r===o&&n>i||r>o?(h=o,u=i,f=r,k=n,y=s,c=a):(h=r,u=n,f=o,k=i,y=a,c=s);var p=new M(h,u),g=new M(f,k);switch(h===f&&u===k||(p.setDown(f,k),g.setUp(h,u)),y%10){case 2:p.move(0,-t.kWidth);break;case 3:p.move(0,-t.kWidth*t.kKakato)}switch(c%10){case 2:g.move(0,t.kWidth);break;case 3:g.move(0,t.kWidth*t.kKakato)}var x=new v([p.getPoint(t.kWidth,0),g.getPoint(t.kWidth,0),g.getPoint(-t.kWidth,0),p.getPoint(-t.kWidth,0)]);r===o&&x.reverse(),e.push(x)}"function"==typeof SuppressedError&&SuppressedError;var L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shotai=c.kGothic,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.getDrawers=function(t){var e=this;return t.map((function(t){return function(o){!function(t,e,o){var i=o.a1_100,a=o.a2_100,s=o.a2_opt,h=o.a3_100,u=o.a3_opt,f=o.a3_opt_1,k=o.x1,y=o.y1,c=o.x2,p=o.y2,g=o.x3,x=o.y3,d=o.x4,v=o.y4;switch(i){case 0:w(e,k,y,c,p,a,h,s,u);break;case 1:if(4===h){var M=k===c&&y===p?[0,t.kMage]:n([k-c,y-p],t.kMage);U(t,e,k,y,W=c+M[0],_=p+M[1],a,1),S(t,e,W,_,c,p,c-2*t.kMage,p-.5*t.kMage)}else U(t,e,k,y,c,p,a,h);break;case 2:case 12:if(4===h){var l=c===g?[0,-t.kMage]:p===x?[-t.kMage,0]:n([c-g,p-x],t.kMage);S(t,e,k,y,c,p,W=g+l[0],_=x+l[1]),S(t,e,W,_,g,x,g-2*t.kMage,x-.5*t.kMage)}else if(5===h&&0===u){var _=x,j=(W=g+t.kMage)+.5*t.kMage,m=x-2*t.kMage;S(t,e,k,y,c,p,g,x),S(t,e,g,x,W,_,j,m)}else S(t,e,k,y,c,p,g,x);break;case 3:var P=k===c&&y===p?[0,t.kMage]:n([k-c,y-p],t.kMage),W=c+P[0],A=(_=p+P[1],c===g&&p===x?[0,-t.kMage]:n([g-c,x-p],t.kMage));if(j=c+A[0],m=p+A[1],U(t,e,k,y,W,_,a,1),S(t,e,W,_,c,p,j,m),5===h&&0===f){var b=g-t.kMage,L=x,K=g+.5*t.kMage,T=x-2*t.kMage;U(t,e,j,m,b,L,1,1),S(t,e,b,L,g,x,K,T)}else U(t,e,j,m,g,x,1,h);break;case 4:var R=r(g-c,x-p)/120*6;R>6&&(R=6);var C=k===c&&y===p?[0,t.kMage*R]:n([k-c,y-p],t.kMage*R),D=(W=c+C[0],_=p+C[1],c===g&&p===x?[0,-t.kMage*R]:n([g-c,x-p],t.kMage*R));j=c+D[0],m=p+D[1],U(t,e,k,y,W,_,a,1),S(t,e,W,_,c,p,j,m),5===h&&0===u?(b=g-t.kMage,L=x,K=g+.5*t.kMage,T=x-2*t.kMage,U(t,e,j,m,b,L,1,1),S(t,e,b,L,g,x,K,T)):U(t,e,j,m,g,x,1,h);break;case 6:if(4===h){var X=g===d?[0,-t.kMage]:x===v?[-t.kMage,0]:n([g-d,x-v],t.kMage);Y(t,e,k,y,c,p,g,x,W=d+X[0],_=v+X[1]),S(t,e,W,_,d,v,d-2*t.kMage,v-.5*t.kMage)}else 5===h&&0===u?(W=d-t.kMage,_=v,j=d+.5*t.kMage,m=v-2*t.kMage,Y(t,e,k,y,c,p,g,x,W,_),S(t,e,W,_,d,v,j,m)):Y(t,e,k,y,c,p,g,x,d,v);break;case 7:U(t,e,k,y,c,p,a,1),S(t,e,c,p,g,x,d,v)}}(e,o,t)}}))},e}(W);function K(t){return t===c.kMincho?new W:new L}return function(){function r(e){this.kMincho=c.kMincho,this.kGothic=c.kGothic,this.kFont=K(c.kMincho),this.stretch=y,this.kFont.setSize(e),this.kBuhin=new t}return Object.defineProperty(r.prototype,"kShotai",{get:function(){return this.kFont.shotai},set:function(t){this.kFont=K(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"kUseCurve",{get:function(){return this.kFont.kUseCurve},set:function(t){this.kFont.kUseCurve=t},enumerable:!1,configurable:!0}),r.prototype.makeGlyph=function(t,e){var r=this.kBuhin.search(e);this.makeGlyph2(t,r)},r.prototype.makeGlyph2=function(t,e){if(""!==e)for(var r=this.getEachStrokes(e),n=0,o=this.kFont.getDrawers(r);n<o.length;n++){(0,o[n])(t)}},r.prototype.makeGlyph3=function(t){var r=[];if(""!==t)for(var n=this.getEachStrokes(t),o=0,i=this.kFont.getDrawers(n);o<i.length;o++){var a=i[o],s=new e;a(s),r.push(s)}return r},r.prototype.makeGlyphSeparated=function(t){var r=this,n=t.map((function(t){return r.getEachStrokes(t)})),o=this.kFont.getDrawers(n.reduce((function(t,e){return t.concat(e)}),[])),i=new e,a=0;return n.map((function(t){for(var r=t.length,n=i.array.length,s=0,h=o.slice(a,a+r);s<h.length;s++){(0,h[s])(i)}a+=r;var u=new e;return u.array=i.array.slice(n),u}))},r.prototype.getEachStrokes=function(t){for(var e=[],r=0,n=t.split("$");r<n.length;r++){var o=n[r].split(":");if(99!==Math.floor(+o[0]))e.push(new p([Math.floor(+o[0]),Math.floor(+o[1]),Math.floor(+o[2]),Math.floor(+o[3]),Math.floor(+o[4]),Math.floor(+o[5]),Math.floor(+o[6]),Math.floor(+o[7]),Math.floor(+o[8]),Math.floor(+o[9]),Math.floor(+o[10])]));else{var i=this.kBuhin.search(o[7]);""!==i&&(e=e.concat(this.getEachStrokesOfBuhin(i,Math.floor(+o[3]),Math.floor(+o[4]),Math.floor(+o[5]),Math.floor(+o[6]),Math.floor(+o[1]),Math.floor(+o[2]),Math.floor(+o[9]),Math.floor(+o[10]))))}}return e},r.prototype.getEachStrokesOfBuhin=function(t,e,r,n,o,i,a,s,h){var u=this.getEachStrokes(t),f=this.getBox(u);0===i&&0===a||(i>100?i-=200:(s=0,h=0));for(var k=0,y=u;k<y.length;k++){var c=y[k];0===i&&0===a||c.stretch(i,s,a,h,f.minX,f.maxX,f.minY,f.maxY),c.x1=e+c.x1*(n-e)/200,c.y1=r+c.y1*(o-r)/200,c.x2=e+c.x2*(n-e)/200,c.y2=r+c.y2*(o-r)/200,c.x3=e+c.x3*(n-e)/200,c.y3=r+c.y3*(o-r)/200,c.x4=e+c.x4*(n-e)/200,c.y4=r+c.y4*(o-r)/200}return u},r.prototype.getBox=function(t){for(var e=200,r=200,n=0,o=0,i=0,a=t;i<a.length;i++){var s=a[i].getBox(),h=s.minX,u=s.maxX,f=s.minY,k=s.maxY;e=Math.min(e,h),n=Math.max(n,u),r=Math.min(r,f),o=Math.max(o,k)}return{minX:e,maxX:n,minY:r,maxY:o}},r.Buhin=t,r.Polygons=e,r}()}();
